\"use client\";\n\nimport { useState, FormEvent } from \"react\";\nimport { createBrowserClient } from \"@/lib/supabase-browser\";\nimport { useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { LogIn, Mail, Lock, Loader, AlertCircle, CheckCircle } from \"lucide-react\";\n\nexport default function LoginPage() {\n    const [email, setEmail] = useState<string>(\"\");\n    const [password, setPassword] = useState<string>(\"\");\n    const [error, setError] = useState<string | null>(null);\n    const [loading, setLoading] = useState<boolean>(false);\n    const [success, setSuccess] = useState<boolean>(false);\n    const router = useRouter();\n    const supabase = createBrowserClient();\n\n    const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        setLoading(true);\n        setError(null);\n        setSuccess(false);\n        try {\n            const { data, error } = await supabase.auth.signInWithPassword({\n                email,\n                password,\n            });\n            if (error) throw error;\n            try {\n                const { data: profile, error: profileError } = await supabase\n                    .from(\"profiles\")\n                    .select(\"id\")\n                    .eq(\"id\", data.user.id)\n                    .single();\n                if (profileError && profileError.code === \"PGRST116\") {\n                    const username =\n                        data.user.user_metadata?.username ||\n                        email.split(\"@\")[0] ||\n                        `user_${Math.random().toString(36).substring(2, 7)}`;\n                    await supabase.from(\"profiles\").insert({\n                        id: data.user.id,\n                        username,\n                        email: data.user.email,\n                        role: \"user\",\n                        created_at: new Date().toISOString(),\n                    });\n                    console.log(\"Perfil criado automaticamente após login\");\n                }\n            } catch (profileError: any) {\n                console.error(\"Erro ao verificar/criar perfil:\", profileError);\n            }\n            setSuccess(true);\n            setTimeout(() => router.push(\"/\"), 1000);\n        } catch (err: any) {\n            setError(err.message || \"Falha ao fazer login. Verifique suas credenciais.\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex justify-center bg-white py-8 px-4 sm:px-6 lg:px-8\">\n            <div className=\"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md border border-[#E5E7EB]\">\n                <div className=\"text-center\">\n                    <h1 className=\"text-3xl font-extrabold text-black\">Entrar</h1>\n                </div>\n                {error && (\n                    <div className=\"flex items-center gap-2 bg-red-50 border border-red-200 text-red-700 p-3 rounded\">\n                        <AlertCircle size={18} />\n                        <span>{error}</span>\n                    </div>\n                )}\n                {success && (\n                    <div className=\"flex items-center gap-2 bg-green-50 border border-green-200 text-green-700 p-3 rounded\">\n                        <CheckCircle size={18} />\n                        <span>Login realizado com sucesso!</span>\n                    </div>\n                )}\n                <form className=\"space-y-6\" onSubmit={handleSubmit}>\n                    <div>\n                        <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                            E-mail\n                        </label>\n                        <div className=\"mt-1 relative rounded-md shadow-sm\">\n                            <input\n                                id=\"email\"\n                                name=\"email\"\n                                type=\"email\"\n                                autoComplete=\"email\"\n                                required\n                                className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#484DB5] focus:border-[#484DB5] sm:text-sm\"\n                                value={email}\n                                onChange={(e) => setEmail(e.target.value)}\n                                disabled={loading}\n                            />\n                            <Mail className=\"absolute right-3 top-2.5 text-gray-400\" size={18} />\n                        </div>\n                    </div>\n                    <div>\n                        <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n                            Senha\n                        </label>\n                        <div className=\"mt-1 relative rounded-md shadow-sm\">\n                            <input\n                                id=\"password\"\n                                name=\"password\"\n                                type=\"password\"\n                                autoComplete=\"current-password\"\n                                required\n                                className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#484DB5] focus:border-[#484DB5] sm:text-sm\"\n                                value={password}\n                                onChange={(e) => setPassword(e.target.value)}\n                                disabled={loading}\n                            />\n                            <Lock className=\"absolute right-3 top-2.5 text-gray-400\" size={18} />\n                        </div>\n                    </div>\n                    <div>\n                        <button\n                            type=\"submit\"\n                            disabled={loading}\n                            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#484DB5] hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#484DB5] transition-all duration-300\"\n                        >\n                            {loading ? (\n                                <Loader className=\"animate-spin mr-2\" size={18} />\n                            ) : <LogIn className=\"mr-2\" size={18} />}\n                            Entrar\n                        </button>\n                    </div>\n                </form>\n                <div className=\"mt-6 text-center\">\n                    <Link href=\"/forgot-password\" className=\"inline-flex items-center text-[#484DB5] hover:underline\">\n                        Esqueceu a senha?\n                    </Link>\n                </div>\n                <div className=\"mt-2 text-center\">\n                    <span className=\"text-gray-500\">Não tem uma conta?</span>{' '}\n                    <Link href=\"/signup\" className=\"inline-flex items-center text-[#484DB5] hover:underline\">\n                        Cadastre-se\n                    </Link>\n                </div>\n            </div>\n        </div>\n    );\n}\n
